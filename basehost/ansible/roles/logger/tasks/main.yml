---
- name: install grafana key
  apt_key:
    url: https://packages.grafana.com/gpg.key
    id:  0D224E82057BCEE1321424B1CA6D481DBD044C76

- name: install grafana repo
  apt_repository:
    repo: deb https://packages.grafana.com/oss/deb stable main

- name: install packages
  package:
    name:
    - grafana
    - prometheus

# - name: configure prometheus
#   template:
#     src:  prometheus.yml.j2
#     dest: /etc/prometheus/prometheus.yml

- name: restart prometheus
  systemd:
    name: prometheus
    state: restarted
    enabled: true

- name: run grafana
  systemd:
    name: grafana-server
    state: started
    enabled: true

- include_role:
    name: common_server
  vars:
    server_hostname: Logger